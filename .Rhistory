grant_bars
vs_graphs_incumbent <- vs_graph_1992 / vs_graph_1996 / vs_graph_2004
vs_graph_1992 <- state_grant_dat_lag %>%
filter(year == 1992) %>%
ggplot(aes(x=grant_chng, y=rep_vote_chng, label = state)) +
geom_vline(xintercept=0, lty=2) +
geom_hline(yintercept=0, lty=2) +
geom_smooth(method="lm", color = "steelblue2") +
xlab("Federal Grant Spending Change (%)") +
ylab("Incumbent Two-Party Vote Share Change (%)") +
geom_text() +
theme_classic() +
theme(axis.title = element_text(size=20),
axis.text = element_text(size=15)) +
theme_clean() +
labs(title = "1992")
vs_graph_1996 <- state_grant_dat_lag %>%
filter(year == 1996) %>%
ggplot(aes(x=grant_chng, y=dem_vote_chng, label = state)) +
geom_vline(xintercept=0, lty=2) +
geom_hline(yintercept=0, lty=2) +
geom_smooth(method="lm", color = "steelblue2") +
xlab("Federal Grant Spending Change (%)") +
ylab("Incumbent Two-Party Vote Share Change (%)") +
geom_text() +
theme_classic() +
theme(axis.title = element_text(size=20),
axis.text = element_text(size=15)) +
theme_clean() +
labs(title = "1996")
vs_graph_2004 <- state_grant_dat_lag %>%
filter(year == 2004) %>%
ggplot(aes(x=grant_chng, y=rep_vote_chng, label = state)) +
geom_vline(xintercept=0, lty=2) +
geom_hline(yintercept=0, lty=2) +
geom_smooth(method="lm", color = "steelblue2") +
xlab("Federal Grant Spending Change (%)") +
ylab("Incumbent Two-Party Vote Share Change (%)") +
geom_text() +
theme_classic() +
theme(axis.title = element_text(size=20),
axis.text = element_text(size=15)) +
theme_clean() +
labs(title = "2004")
vs_graphs_incumbent <- vs_graph_1992 / vs_graph_1996 / vs_graph_2004
ggsave(path = "images", filename = "vs_graphs_incumbent.png", height = 16, width = 8)
vs_graphs_incumbent
head(state_grant_dat_lag)
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T | year != 1984)
head(state_grant_dat)
head(state_grant_dat_lag)
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T & year != 1984)
head(state_grant_dat_lag)
state_grant_dat_lag %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng))
state_grant_dat_lag %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng)) %>%
lm(inc_vote_chng ~ grant_chng)
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T & year != 1984) %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng))
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T & year != 1984) %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng))
vs_graph_1992 <- state_grant_dat_lag %>%
filter(year == 1992) %>%
ggplot(aes(x=grant_chng, y=inc_vote_chng, label = state)) +
geom_vline(xintercept=0, lty=2) +
geom_hline(yintercept=0, lty=2) +
geom_smooth(method="lm", color = "steelblue2") +
xlab("Federal Grant Spending Change (%)") +
ylab("Incumbent Two-Party Vote Share Change (%)") +
geom_text() +
theme_classic() +
theme(axis.title = element_text(size=20),
axis.text = element_text(size=15)) +
theme_clean() +
labs(title = "1992")
vs_graph_1996 <- state_grant_dat_lag %>%
filter(year == 1996) %>%
ggplot(aes(x=grant_chng, y=inc_vote_chng, label = state)) +
geom_vline(xintercept=0, lty=2) +
geom_hline(yintercept=0, lty=2) +
geom_smooth(method="lm", color = "steelblue2") +
xlab("Federal Grant Spending Change (%)") +
ylab("Incumbent Two-Party Vote Share Change (%)") +
geom_text() +
theme_classic() +
theme(axis.title = element_text(size=20),
axis.text = element_text(size=15)) +
theme_clean() +
labs(title = "1996")
vs_graph_2004 <- state_grant_dat_lag %>%
filter(year == 2004) %>%
ggplot(aes(x=grant_chng, y=inc_vote_chng, label = state)) +
geom_vline(xintercept=0, lty=2) +
geom_hline(yintercept=0, lty=2) +
geom_smooth(method="lm", color = "steelblue2") +
xlab("Federal Grant Spending Change (%)") +
ylab("Incumbent Two-Party Vote Share Change (%)") +
geom_text() +
theme_classic() +
theme(axis.title = element_text(size=20),
axis.text = element_text(size=15)) +
theme_clean() +
labs(title = "2004")
vs_graphs_incumbent <- vs_graph_1992 / vs_graph_1996 / vs_graph_2004
ggsave(path = "images", filename = "vs_graphs_incumbent.png", height = 16, width = 8)
lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)
summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)) %>%
tidy()
lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)) %>%
tidy()
lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)
grant_md <- lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)
grant_md <- lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)
tidy(grant_md)
summary <- summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
summary$r.squared
summary$coefficients
covid_grants <- read.csv("data/covid_grants.csv")
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party"))
state_poll     <- state_time_dat[!is.na(state_time_dat$avg_support),]
state_inc <- state_poll[state_poll$incumbent_party,]
state_chl <- state_poll[!state_poll$incumbent_party,]
head(state_time_dat)
head(state_inc)
head(state_time_dat)
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party")) %>%
select(state, year, R_pv2p, D_pv2p, avg_support, incumbent, incumbent_party)
head(state_time_dat)
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party")) %>%
select(state, year, R_pv2p, D_pv2p, avg_support, incumbent, incumbent_party) %>%
inner_join(state_grant_dat_lag, by = c("year", "state"))
state_time_dat
head(state_time_dat)
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party")) %>%
select(state, year, avg_support, incumbent, incumbent_party)
head(state_time_dat)
head(state_grant_dat_lag)
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party")) %>%
select(state, year, avg_support, incumbent) %>%
inner_join(state_grant_dat_lag, by = c("year", "state", "incumbent"))
state_time_dat
head(state_time_dat)
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T & year != 1984) %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng)) %>%
mutate(inc_pv2p = ifelse(year == 1996, dem_vote_chng, rep_vote_chng))
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party")) %>%
select(state, year, avg_support, incumbent) %>%
inner_join(state_grant_dat_lag, by = c("year", "state", "incumbent"))
head(state_time_dat)
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T & year != 1984) %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng)) %>%
mutate(inc_pv2p = ifelse(year == 1996, D_pv2p, R_pv2p))
state_time_dat <- popvote_state %>%
full_join(avgpoll_time_state %>%
filter(weeks_left > 5 & weeks_left < 11) %>%
group_by(year,party, state) %>%
summarise(avg_support=mean(avg_poll))) %>%
left_join(popvote, by = c("year", "party")) %>%
select(state, year, avg_support, incumbent) %>%
inner_join(state_grant_dat_lag, by = c("year", "state", "incumbent"))
head(state_time_dat)
summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
tidy(summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)))
tidy((lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
tidy((lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)))
lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)
summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
lm_fed <- summary(lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag))
stats <- data.frame(
row.names = c("lm_fed"),
model = c("Federal Grant Spending Model"),
r_squared = c(
lm_fed$r.squared),
mse = c(
sqrt(mean(lm_fed$residuals ^ 2))
)
)
stats
stats <- data.frame(
row.names = c("lm_fed"),
model = c("Federal Grant Spending Model"),
r_squared = c(
lm_fed$r.squared),
mse = c(
sqrt(mean(lm_fed$residuals ^ 2))
),
coef = c(
lm_fed$coefficients
)
)
stats <- data.frame(
stats <- data.frame(
row.names = c("lm_fed"),
model = c("Federal Grant Spending Model"),
r_squared = c(
lm_fed$r.squared),
mse = c(
sqrt(mean(lm_fed$residuals ^ 2))
))
stats
stats
View(stats)
tidy(lm_fed)
fed_mod <- lm(inc_vote_chng ~ grant_chng, state_grant_dat_lag)
lm_fed <- summary(fed_mod)
stats <- data.frame(
row.names = c("lm_fed"),
model = c("Federal Grant Spending Model"),
r_squared = c(
lm_fed$r.squared),
mse = c(
sqrt(mean(lm_fed$residuals ^ 2))
))
tidy(lm_fed)
tidy(fed_mod)
?tidy
?tidy
tidy(fed_mod, conf.level = 0.95)
tidy(fed_mod, conf.level = 0.95)
tidy(fed_mod, conf.int = T)
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng")
?bind_rows
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_rows(stats)
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats)
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats) %>%
select(model, r_squared, mse, estimat,e conf.low, conf.high)
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats) %>%
select(model, r_squared, mse, estimate, conf.low, conf.high)
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats) %>%
select(model, r_squared, mse, estimate, conf.low, conf.high) %>%
gt()
tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats) %>%
select(r_squared, mse, estimate, conf.low, conf.high) %>%
gt() +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
clean_model <- tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats) %>%
select(r_squared, mse, estimate, conf.low, conf.high)
clean_model %>%
gt() +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
clean_model
clean_model +
gt() +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
gt(clean_model) +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
gt(clean_model) +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
stats <- data.frame(
row.names = c("lm_fed"),
model = c("Federal Grant Spending Model"),
r_squared = c(
lm_fed$r.squared),
mse = c(
sqrt(mean(lm_fed$residuals ^ 2))
))
clean_model <- tidy(fed_mod, conf.int = T) %>%
filter (term == "grant_chng") %>%
bind_cols(stats) %>%
select(r_squared, mse, estimate, conf.low, conf.high)
clean_model
gt(clean_model) +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
poll_models_gt <- gt(stats) %>%
tab_header(title = "Poll Only and Poll and GDP Growth Models for Predicting Elections") %>%
cols_label(model = "Model",
r_squared = "R Squared",
mse = "MSE") %>%
fmt_number(columns = 2:3,
decimals = 2)
poll_models_gt
class(stats)
class(clean_model)
data.frame(clean_model)
gt(clean_model) +
tab_header(title = "Federal Grant Spending Model") +
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
gt(clean_model)
gt(clean_model)
gt(clean_model) +
tab_header(title = "Federal Grant Spending Model")
gt(clean_model)
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(estimate:conf.high, label = "95% Confidence Interval")
?tab_spanner
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(xolumns = estimate:conf.high, label = "95% Confidence Interval")
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = estimate:conf.high, label = "95% Confidence Interval")
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = vars(estimate:conf.high), label = "95% Confidence Interval")
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = vars(estimate, conf.low, conf.high), label = "95% Confidence Interval")
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = vars(estimate, conf.low, conf.high), label = "95% Confidence Interval") %>%
cols_label(r_squared = "R Squared",
mse  = "MSE",
estimate = "Point Estimate",
conf.low = "Low",
conf.high = "High")
gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = vars(estimate, conf.low, conf.high), label = "95% Confidence Interval") %>%
cols_label(r_squared = "R Squared",
mse  = "MSE",
estimate = "Point Estimate",
conf.low = "Low",
conf.high = "High") %>%
fmt_number(columns = 1:5,
decimals = 2)
federal_spending_gt <- gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = vars(estimate, conf.low, conf.high), label = "95% Confidence Interval") %>%
cols_label(r_squared = "R Squared",
mse  = "MSE",
estimate = "Point Estimate",
conf.low = "Low",
conf.high = "High") %>%
fmt_number(columns = 1:5,
decimals = 2)
federal_spending_gt <- gt(clean_model) %>%
tab_header(title = "Federal Grant Spending Model") %>%
tab_spanner(columns = vars(estimate, conf.low, conf.high), label = "95% Confidence Interval") %>%
cols_label(r_squared = "R Squared",
mse  = "MSE",
estimate = "Point Estimate",
conf.low = "Low",
conf.high = "High") %>%
fmt_number(columns = 1:5,
decimals = 2)
gtsave(data = federal_spending_gt, path = "images", filename = "federal_spending_gt.png")
head(covid_grants)
covid_grants%>%
transform(Total = str_replace(Total,"$",""))
covid_grants$Total <- gsub("$", "", covid_grants$Total)
covid_grants
?paste
?gsub
install.packages("magritt")
install.packages("magrittr")
library(magrittr)
?transform
covid_grants %>%
transform(Total = str_replace(Total,"M",""))
covid_grants %>%
mutate(money = str_replace(Total,"M",""))
?str_replace
covid_grants %>%
mutate(money = str_replace(covid_grants$Total,"M",""))
library(janitor)
install.packages("janitor")
library(janitor)
covid_grants <- read.csv("data/covid_grants.csv") %>%
clean_names()
covid_grants
str_replace(covid_grants$total, "$","")
covid_grants$total <- str_replace(covid_grants$total, "$", "")
covid_grants
covid_grants %>%
str_replace_all(c("$" = ""))
covid_grants %>%
str_replace_all(c("$" = ""))
str_replace(covid_grants$total, "$", "")
str_replace_all(covid_grants$total, "$", "")
class(covid_grants$total)
head(grant_state)
grant_state %>%
filter(state == "California")
grant_state %>%
filter(state == "California")
grant_state %>%
filter(state_abb == "California")
grant_state %>%
filter(state_abb == "California" & year >= 2008)
grant_state %>%
filter(state_abb == "California" & year >= 2008) %>%
pull(grant_mil)
grant_state %>%
filter(state_abb == "California" & year >= 2008) %>%
pull(grant_mil) * 1000000
covid_grants
cali <- grant_state %>%
filter(state_abb == "California" & year >= 2008) %>%
pull(grant_mil) * 1000000
2459021414/cali
cali <- grant_state %>%
filter(state_abb == "California" & year >= 2008)
cali
cali <- grant_state %>%
filter(state_abb == "Florida" & year >= 2008) %>%
pull(grant_mil) * 1000000
cali
florida <- grant_state %>%
filter(state_abb == "Florida" & year >= 2008) %>%
pull(grant_mil) * 1000000
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
mutate(dif_chng = grant_mil - lag(grant_mil, default = first(grant_mil)) / lag(grant_mil, default = first(grant_mil)) * 100) %>%
filter(incumbent == T & year != 1984) %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng)) %>%
mutate(inc_pv2p = ifelse(year == 1996, D_pv2p, R_pv2p))
head(state_grant_dat_lag)
state_grant_dat_lag <- clean_popvote %>%
group_by(state) %>%
mutate(dem_vote_chng = D_pv2p - lag(D_pv2p, default = first(D_pv2p))) %>%
mutate(rep_vote_chng = R_pv2p - lag(R_pv2p, default = first(R_pv2p))) %>%
mutate(grant_chng = (grant_mil / lag(grant_mil, default = first(grant_mil)) - 1) * 100) %>%
filter(incumbent == T & year != 1984) %>%
mutate(inc_vote_chng = ifelse(year == 1996, dem_vote_chng, rep_vote_chng)) %>%
mutate(inc_pv2p = ifelse(year == 1996, D_pv2p, R_pv2p))
covid_grants
florida
(1102682087 / florida - 1) * 100
florida
grant_chng <- (1102682087 / florida - 1) * 100
predict(fed_mod, newdata = grant_chng)
predict(fed_mod, newdata = data.frame(grant_chng = number))
number <- (1102682087 / florida - 1) * 100
predict(fed_mod, newdata = data.frame(grant_chng = number))
